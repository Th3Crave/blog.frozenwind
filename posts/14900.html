<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="人生到处知何似，应似飞鸿踏雪泥。泥上偶然留指爪，鸿飞那复计东西。"><title>云原生-Knative | frozeNwInd</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement('script');
  hm.src = 'https://hm.baidu.com/hm.js?' + 'bbf19a98c9ae28f2e1e8cfcee1d9585e';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><meta name="generator" content="Hexo 5.4.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">云原生-Knative</h1><a id="logo" href="/.">frozeNwInd</a><p class="description">吕乘风的博客</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/tags/"><i class="fa fa-tag"> 标签</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/history/"><i class="fa fa-history"> 历史</i></a><a href="/message/"><i class="fa fa-comment"> 留言</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">云原生-Knative</h1><div class="post-meta">2023-06-06<span> | </span><span class="category"><a href="/categories/technology/">technology</a><a href="/categories/technology/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a></span></div><div class="post-content"><h2 id="云计算"><a href="#云计算" class="headerlink" title="云计算"></a>云计算</h2><p><a target="_blank" rel="noopener" href="https://murphy.blog.csdn.net/article/details/127846026">https://murphy.blog.csdn.net/article/details/127846026</a></p>
<h2 id="Serverless"><a href="#Serverless" class="headerlink" title="Serverless"></a>Serverless</h2><h2 id="Knative"><a href="#Knative" class="headerlink" title="Knative"></a>Knative</h2><p>Knative 是谷歌牵头发起的 Serverless 项目。<br>其目标是基于 Kubernetes 的 Serverless 解决方案，旨在标准化 Serverless，简化其学习成本。</p>
<p>Knative 是以 Kubernetes 的一组自定义资源类型（CRD）的方式来安装的，因此只需使用几个 YAML 文件就可以轻松地开始使用 Knative 了。<br>这也意味着，在本地或者托管云服务上，任何可以运行 Kubernetes 的地方都可以运行 Knative 和代码。</p>
<p><img src="/posts/14900/knative-%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B.png"></p>
<h3 id="Knative的定位"><a href="#Knative的定位" class="headerlink" title="Knative的定位"></a>Knative的定位</h3><p><img src="/posts/14900/knative-%E5%AE%9A%E4%BD%8D.png"></p>
<p>Knative构建在<strong>Kubernetes、Istio、Container</strong>的基础上，以<strong>K8S的CRD</strong>形式存在。</p>
<ul>
<li>基础设施：<strong>Kubernetes作为基础设施</strong>进行容器编排，解决应用编排和运行环境</li>
<li>通信设施：<strong>Isito作为通信基础设施层</strong>，保证服务的运行可检测、可配置、可追踪</li>
<li>模板+环境：<strong>Knative</strong>使用应用模板和统一的运行环境来标准化服务的构建、部署和管理</li>
</ul>
<p>Knative 解决了现在Serverless 的诸多问题。<br>如果kubernetes是容器编排的事实上的标准，那么Knative也许就是未来serverless的事实上的标准。</p>
<p>Knative的优势：</p>
<ul>
<li>便利性：Knative 以 Kubernetes 作为其底层框架，因此无论是线上还是线下，任何 Kubernetes 集群，无论是云上 Kubernetes 服务还是自建 Kubernetes 集群，都可通过安装 knative 插件快速的搭建 serverless 平台。</li>
<li><strong>标准化</strong>：Knative 联合 CNCF，<strong>把所有事件标准化，统一为 CloudEvent</strong>，提供事件的跨平台，同时让函数和具体的调用方能够解耦。</li>
<li>服务间解耦：使用 Knative 使得应用不在与底层依赖服务强绑定，可以跨云实现业务互通。</li>
<li>成熟的生态：Knative 基于 Kubernetes 体系构建，与 kubernetes 生态结合更紧密。</li>
<li>自动伸缩：监控应用的请求，并自动扩缩容, 借助于istio(ambassador,gloo等)天生支持蓝绿发布、回滚功能，方便应用发布流程。</li>
<li>应用监控：支持日志的收集、查找和分析，并支持 VAmetrics 数据展示、调用关系 tracing。</li>
</ul>
<h3 id="Knative的组成"><a href="#Knative的组成" class="headerlink" title="Knative的组成"></a>Knative的组成</h3><p>为了实现 serverless 应用的管理，knative 把整个系统分成了三个部分：</p>
<ul>
<li><strong>Build：构建模块</strong>，把用户定义的函数和应用 build 成容器镜像，提供云原生“从源代码到容器”的镜像构建能力。</li>
<li><strong>Serving：服务模块</strong>，用来配置应用的路由、升级策略、自动扩缩容等功能，通过 Serving 部署容器并提供通用的服务模型。</li>
<li><strong>Eventing：事件模块</strong>，用来自动完成事件的绑定和触发，提供事件全局订阅、传递和管理能力，实现事件驱动。</li>
</ul>
<h4 id="Build-构建模块"><a href="#Build-构建模块" class="headerlink" title="Build 构建模块"></a>Build 构建模块</h4><h4 id="Serving-服务模块"><a href="#Serving-服务模块" class="headerlink" title="Serving 服务模块"></a>Serving 服务模块</h4><p>基于负载自动伸缩，包括在没有负载时缩减到零。<br>允许为多个修订版本（revision）应用创建流量策略，从而能够通过 URL 轻松路由到目标应用程序。</p>
<p>knative serving 功能是<strong>基于 kubernetes 和 istio 开发</strong>的。可以认为 knative 提供了更高的抽象，自动封装掉了 kubernetes 和 istio 的实现细节。</p>
<ul>
<li>kubernetes 来管理容器（deployment、pod）</li>
<li>istio 来管理网络路由（VirtualService、DestinationRule）</li>
</ul>
<p>serving 的核心功能是<strong>让应用运行起来提供服务</strong>。<br>虽然听起来很简单，但包括了很多的事情：</p>
<ul>
<li>自动化启动和销毁容器</li>
<li>根据名字生成网络访问相关的 service、ingress 等对象</li>
<li>监控应用的请求，并自动扩缩容</li>
<li>支持蓝绿发布、回滚功能，方便应用方法流程</li>
</ul>
<h4 id="Eventing-事件模块"><a href="#Eventing-事件模块" class="headerlink" title="Eventing 事件模块"></a>Eventing 事件模块</h4><p>使得生产和消费事件变得容易。<br>抽象出事件源，并允许操作人员使用自己选择的消息传递层。</p>
<p>serverless 最重要的是<strong>基于事件的触发机制</strong>，也就是说当某件事发生时，就触发某个特定的函数。</p>
<p>事件概念的出现，让函数和具体的调用方能够解耦。<br>函数部署出来不用关心谁会调用它，而事件源触发也不用关心谁会处理它。</p>
<p>为了让整个事件系统更有扩展性和通用性，knative 定义了很多事件相关的概念。简单介绍一下：</p>
<ul>
<li>EventSource：<strong>事件源</strong>，能够产生事件的外部系统。</li>
<li>Feed：把某种类型的 EventType 和 EventSource 和对应的 Channel 绑定到一起。</li>
<li>Channel：<strong>对消息实现的一层抽象</strong>，后端可以使用 kafka、RabbitMQ、Google PubSub 作为具体的实现。</li>
<li>Subscription：<strong>把 channel 和后端的函数绑定到一起</strong>，一个 channel 可以绑定到多个knative service。</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://skyao.io/learning-knative/introduction/motivation.html">https://skyao.io/learning-knative/introduction/motivation.html</a><br><a target="_blank" rel="noopener" href="https://www.bookstack.cn/read/getting-started-with-knative/eventing.md">https://www.bookstack.cn/read/getting-started-with-knative/eventing.md</a></p>
<h2 id="Knative-Eventing"><a href="#Knative-Eventing" class="headerlink" title="Knative - Eventing"></a>Knative - Eventing</h2><p>Kubernetes 用户在实现开发和部署阶段服务之间松耦合的同时，服务间常要通过不同的事件机制来进行事件传递，<strong>为了解决大部分的云原生消息通信需求</strong>，Knative 提供了 Eventing 组件。</p>
<p><img src="/posts/14900/knative-eventing-%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E7%A4%BA%E6%84%8F%E5%9B%BE.png"></p>
<p>Eventing 主要由<strong>事件源（Event Source）</strong>、<strong>事件处理（Flow）</strong>、<strong>事件消费者（Event Consumer）</strong>三部分构成。</p>
<ul>
<li>事件源 Event Source</li>
<li>事件处理 Flow<ul>
<li>Source to Service，直接事件接收<br>通过事件源直接转发到单一事件消费者。支持直接调用 Knative Service 或者 Kubernetes Service 进行消费处理。这样的场景下，如果调用的服务不可用，事件源负责重试机制处理。</li>
<li>Channels &amp; Subscriptions，通过事件通道(Channel)以及事件订阅(Subscriptions)转发事件处理<br>这样的情况下，可以通过 Channel 保证事件不丢失并进行缓冲处理，通过 Subscriptions 订阅事件以满足多个消费端处理。</li>
<li>Brokers &amp; Triggers，通过 brokers 和 triggers 支持事件消费及过滤机制<br>从 v0.5 开始，Knative Eventing 定义 Broker 和 Trigger 对象，实现了对事件进行过滤（亦如通过 ingress 和 ingress controller 对网络流量的过滤一样）。<br>通过定义 Broker 创建 Channel，通过 Trigger 创建 Channel 的订阅（subscription），并产生事件过滤规则。</li>
</ul>
</li>
<li>事件消费者 Event Consumer</li>
</ul>
<h3 id="Event-Source"><a href="#Event-Source" class="headerlink" title="Event Source"></a>Event Source</h3><p>事件源是 Kubernetes 自定义资源，它提供了一种机制用于注册特定软件系统对某一类事件的兴趣。</p>
<h3 id="Event-Registry"><a href="#Event-Registry" class="headerlink" title="Event Registry"></a>Event Registry</h3><p>Event Registry 维护着一个事件类型目录，这些事件可以从不同Broker中消费。<br>Event Registry 引入了一个新的 EventType CRD，以便将事件类型的信息持久化在集群的数据存储中。</p>
<p><strong>利用Registry发现事件</strong>：使用Registry，可以发现能够从Broker的事件网格中消费的不同类型的事件。该Registry是为与Broker/Trigger模型一起使用而设计的，旨在帮助创建Triggers。</p>
<h3 id="Broker-amp-Trigger"><a href="#Broker-amp-Trigger" class="headerlink" title="Broker &amp; Trigger"></a>Broker &amp; Trigger</h3><ul>
<li>Broker<br><img src="/posts/14900/knative-eventing-broker.png"><br>Broker代表了 “Event Mesh”。事件被发送到Broker的入口（Ingress），然后被发送到对该事件感兴趣的任何订阅者。一旦进入Broker，除CloudEvent之外的所有元数据都会被剥离（例如，除非设置为CloudEvent属性，否则没有该事件如何进入Broker的概念）。</li>
<li>Trigger<br>Trigger 代表了从特定的Broker订阅事件的愿望。</li>
</ul>
<h3 id="Channel"><a href="#Channel" class="headerlink" title="Channel"></a>Channel</h3><p>Channels是Kubernetes Custom Resources(k8s自定义资源)，它定义了一个单一的事件转发和持久层。<br>消息实现可以通过Kubernetes Custom Resource提供Channel的实现，支持不同的技术，如Apache Kafka或NATS Streaming。</p>
</div><div class="tags"><a href="/tags/云原生"><i class="fa fa-tag">云原生</i></a><a href="/tags/Knative"><i class="fa fa-tag">Knative</i></a></div><div class="post-nav"><a class="pre" href="/posts/18398.html">云原生-Istio</a><a class="next" href="/posts/7396.html">Spring-IOC-实现原理详解-2-Bean实例化</a></div><div id="container"></div><link rel="stylesheet" type="text/css" href="//unpkg.com/gitalk/dist/gitalk.css"><script type="text/javascript" src="//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js"></script><script type="text/javascript" src="//unpkg.com/gitalk/dist/gitalk.min.js"></script><script>var gitalk = new Gitalk({
  clientID: '8359b7a19b78f2b9e112',
  clientSecret: '5ad69dc1633a1834322067d017b6313bd231457c',
  repo: 'gitalk',
  owner: 'Th3Crave',
  admin: ['Th3Crave'],
  id: md5(location.pathname),
  distractionFreeMode: false
})
gitalk.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar-toc"><div class="stoc-article" id="sidebar-stoc"><strong class="stoc-title"><i class="fa"> Contents </i></strong><div class="toc-nav" id="stoc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%91%E8%AE%A1%E7%AE%97"><span class="toc-text">云计算</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Serverless"><span class="toc-text">Serverless</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Knative"><span class="toc-text">Knative</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Knative%E7%9A%84%E5%AE%9A%E4%BD%8D"><span class="toc-text">Knative的定位</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Knative%E7%9A%84%E7%BB%84%E6%88%90"><span class="toc-text">Knative的组成</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Build-%E6%9E%84%E5%BB%BA%E6%A8%A1%E5%9D%97"><span class="toc-text">Build 构建模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Serving-%E6%9C%8D%E5%8A%A1%E6%A8%A1%E5%9D%97"><span class="toc-text">Serving 服务模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Eventing-%E4%BA%8B%E4%BB%B6%E6%A8%A1%E5%9D%97"><span class="toc-text">Eventing 事件模块</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Knative-Eventing"><span class="toc-text">Knative - Eventing</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Event-Source"><span class="toc-text">Event Source</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Event-Registry"><span class="toc-text">Event Registry</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Broker-amp-Trigger"><span class="toc-text">Broker &amp; Trigger</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Channel"><span class="toc-text">Channel</span></a></li></ol></li></ol></div><script type="text/javascript" src="/js/toc.js?v=1.0.0"></script></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2023 <a href="/." rel="nofollow">frozeNwInd.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=1.0.0"><script type="text/javascript" src="/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>